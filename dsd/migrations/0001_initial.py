# Generated by Django 5.2.11 on 2026-02-27 00:30

import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='BRDataExportLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('export_date', models.DateTimeField(auto_now_add=True)),
                ('export_type', models.CharField(choices=[('PRICE_CHANGE', 'Price Change'), ('NEW_ITEM', 'New Item'), ('DISCO', 'Discontinue'), ('TPR', 'Temporary Price Reduction')], max_length=20)),
                ('vendor_code', models.CharField(max_length=20)),
                ('upc', models.CharField(max_length=14)),
                ('brdata_item_no', models.CharField(blank=True, max_length=20, null=True)),
                ('new_retail', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('effective_date', models.DateField(blank=True, null=True)),
                ('export_status', models.CharField(choices=[('PENDING', 'Pending'), ('SENT', 'Sent'), ('CONFIRMED', 'Confirmed'), ('FAILED', 'Failed')], default='PENDING', max_length=20)),
                ('export_file', models.CharField(blank=True, max_length=200, null=True)),
                ('error_message', models.TextField(blank=True, null=True)),
                ('exported_by', models.CharField(blank=True, max_length=50, null=True)),
                ('confirmed_at', models.DateTimeField(blank=True, null=True)),
            ],
            options={
                'verbose_name': 'BRData Export Log',
                'verbose_name_plural': 'BRData Export Log',
                'db_table': 'dsd_brdata_export_log',
                'ordering': ['-export_date'],
            },
        ),
        migrations.CreateModel(
            name='LinkGroup',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('link_code', models.CharField(max_length=20)),
                ('link_group_name', models.CharField(max_length=100)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Link Group',
                'verbose_name_plural': 'Link Groups',
                'db_table': 'dsd_link_group',
                'ordering': ['vendor', 'link_code'],
            },
        ),
        migrations.CreateModel(
            name='Vendor',
            fields=[
                ('vendor_code', models.CharField(max_length=20, primary_key=True, serialize=False)),
                ('vendor_name', models.CharField(max_length=100)),
                ('rep_name', models.CharField(blank=True, max_length=100, null=True)),
                ('rep_email', models.EmailField(blank=True, max_length=100, null=True)),
                ('rep_phone', models.CharField(blank=True, max_length=20, null=True)),
                ('comm_method', models.CharField(blank=True, choices=[('EXCEL', 'Excel Spreadsheet'), ('EMAIL', 'Email'), ('EDI', 'EDI'), ('PORTAL', 'Vendor Portal'), ('PAPER', 'Paper / Fax'), ('OTHER', 'Other')], max_length=30, null=True)),
                ('target_margin', models.DecimalField(decimal_places=4, default=Decimal('0.2800'), help_text='Default target margin e.g. 0.2850 = 28.5%', max_digits=5)),
                ('is_active', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Vendor',
                'verbose_name_plural': 'Vendors',
                'db_table': 'dsd_vendor',
                'ordering': ['vendor_code'],
            },
        ),
        migrations.CreateModel(
            name='ChangeHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('vendor_code', models.CharField(max_length=20)),
                ('upc', models.CharField(max_length=14)),
                ('change_date', models.DateTimeField(auto_now_add=True)),
                ('change_type', models.CharField(choices=[('COST_AND_PRICE', 'Cost & Price Change'), ('COST_ONLY', 'Cost Change Only'), ('PRICE_ONLY', 'Price Change Only')], default='COST_AND_PRICE', max_length=20)),
                ('old_case_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('old_allowance', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('new_case_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('new_allowance', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('old_retail', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('new_retail', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('old_margin', models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ('new_margin', models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ('changed_by', models.CharField(blank=True, max_length=50, null=True)),
                ('change_source', models.CharField(choices=[('MANUAL', 'Manual Entry'), ('IMPORT', 'File Import'), ('PORTAL', 'Vendor Portal'), ('BRDATA_SYNC', 'BRData Sync'), ('SYSTEM', 'System')], default='MANUAL', max_length=20)),
                ('pending_cost_change_id', models.IntegerField(blank=True, help_text='ID of the PendingCostChange that triggered this', null=True)),
                ('price_change_reason', models.CharField(blank=True, choices=[('COMPETITIVE', 'Competitive Response'), ('MARKET', 'Market Condition'), ('CORRECTION', 'Price Correction'), ('OTHER', 'Other')], help_text='Required for PRICE_ONLY changes', max_length=20, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
            ],
            options={
                'verbose_name': 'Change History',
                'verbose_name_plural': 'Change History',
                'db_table': 'dsd_change_history',
                'ordering': ['-change_date'],
                'indexes': [models.Index(fields=['vendor_code', 'upc'], name='dsd_change__vendor__ecad87_idx'), models.Index(fields=['change_date'], name='dsd_change__change__9c6efe_idx'), models.Index(fields=['change_type'], name='dsd_change__change__cd533d_idx')],
            },
        ),
        migrations.CreateModel(
            name='Item',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('upc', models.CharField(help_text='Normalized UPC — no hyphens or spaces', max_length=14)),
                ('seq', models.IntegerField(blank=True, help_text='Display sequence within vendor', null=True)),
                ('brdata_item_no', models.CharField(blank=True, help_text='BRData PLU / Vendor Item Number', max_length=20, null=True)),
                ('description', models.CharField(max_length=100)),
                ('case_pack', models.IntegerField(default=1)),
                ('size_alpha', models.CharField(blank=True, max_length=20, null=True)),
                ('case_cost', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('allowance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('price_qty', models.IntegerField(default=1)),
                ('retail_price', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('last_cost_change', models.DateField(blank=True, help_text='Date of last vendor cost change', null=True)),
                ('last_price_change', models.DateField(blank=True, help_text='Date of last buyer retail price change', null=True)),
                ('is_disco', models.BooleanField(default=False)),
                ('is_tpr', models.BooleanField(default=False)),
                ('movement', models.IntegerField(blank=True, help_text='Units sold — sourced from BRData', null=True)),
                ('movement_updated_at', models.DateTimeField(blank=True, null=True)),
                ('vendor_comments', models.TextField(blank=True, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('link_group', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='items', to='dsd.linkgroup')),
                ('vendor', models.ForeignKey(db_column='vendor_code', on_delete=django.db.models.deletion.RESTRICT, related_name='items', to='dsd.vendor')),
            ],
            options={
                'verbose_name': 'Item',
                'verbose_name_plural': 'Items',
                'db_table': 'dsd_item',
                'ordering': ['vendor', 'seq', 'description'],
                'unique_together': {('vendor', 'upc')},
            },
        ),
        migrations.CreateModel(
            name='PendingCostChange',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('vendor_code', models.CharField(max_length=20)),
                ('upc', models.CharField(max_length=14)),
                ('new_case_cost', models.DecimalField(decimal_places=2, max_digits=10)),
                ('new_allowance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=10)),
                ('effective_date', models.DateField()),
                ('suggested_retail', models.DecimalField(blank=True, decimal_places=2, help_text='System calculated suggested retail', max_digits=10, null=True)),
                ('approved_retail', models.DecimalField(blank=True, decimal_places=2, help_text='Buyer accepted or overridden retail', max_digits=10, null=True)),
                ('prev_case_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('prev_allowance', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('prev_retail', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('prev_margin', models.DecimalField(blank=True, decimal_places=4, max_digits=5, null=True)),
                ('status', models.CharField(choices=[('PENDING', 'Pending Review'), ('APPROVED', 'Approved'), ('REJECTED', 'Rejected'), ('APPLIED', 'Applied')], default='PENDING', max_length=20)),
                ('change_source', models.CharField(choices=[('MANUAL', 'Manual Entry'), ('IMPORT', 'File Import'), ('PORTAL', 'Vendor Portal'), ('BRDATA_SYNC', 'BRData Sync')], default='MANUAL', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('applied_at', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_cost_changes', to=settings.AUTH_USER_MODEL)),
                ('item', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='pending_cost_changes', to='dsd.item')),
                ('submitted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='submitted_cost_changes', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Pending Cost Change',
                'verbose_name_plural': 'Pending Cost Changes',
                'db_table': 'dsd_pending_cost_change',
                'ordering': ['effective_date', 'vendor_code'],
            },
        ),
        migrations.AddField(
            model_name='linkgroup',
            name='vendor',
            field=models.ForeignKey(db_column='vendor_code', on_delete=django.db.models.deletion.RESTRICT, related_name='link_groups', to='dsd.vendor'),
        ),
        migrations.CreateModel(
            name='VendorImportLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('import_date', models.DateTimeField(auto_now_add=True)),
                ('filename', models.CharField(blank=True, max_length=200, null=True)),
                ('import_source', models.CharField(choices=[('EXCEL', 'Excel Spreadsheet'), ('EMAIL', 'Email Attachment'), ('MANUAL', 'Manual Entry'), ('PORTAL', 'Vendor Portal'), ('API', 'API')], default='EXCEL', max_length=20)),
                ('records_processed', models.IntegerField(default=0)),
                ('records_updated', models.IntegerField(default=0)),
                ('records_added', models.IntegerField(default=0)),
                ('records_skipped', models.IntegerField(default=0)),
                ('records_error', models.IntegerField(default=0)),
                ('import_status', models.CharField(choices=[('PENDING', 'Pending'), ('COMPLETE', 'Complete'), ('FAILED', 'Failed')], default='PENDING', max_length=20)),
                ('error_log', models.TextField(blank=True, null=True)),
                ('imported_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='import_logs', to=settings.AUTH_USER_MODEL)),
                ('vendor', models.ForeignKey(db_column='vendor_code', on_delete=django.db.models.deletion.RESTRICT, related_name='import_logs', to='dsd.vendor')),
            ],
            options={
                'verbose_name': 'Vendor Import Log',
                'verbose_name_plural': 'Vendor Import Logs',
                'db_table': 'dsd_vendor_import_log',
                'ordering': ['-import_date'],
            },
        ),
        migrations.AlterUniqueTogether(
            name='linkgroup',
            unique_together={('link_code', 'vendor')},
        ),
        migrations.CreateModel(
            name='VendorImportMapping',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('mapping_name', models.CharField(default='default', max_length=50)),
                ('upc_column', models.CharField(blank=True, max_length=10, null=True)),
                ('description_column', models.CharField(blank=True, max_length=10, null=True)),
                ('case_cost_column', models.CharField(blank=True, max_length=10, null=True)),
                ('allowance_column', models.CharField(blank=True, max_length=10, null=True)),
                ('effective_date_column', models.CharField(blank=True, max_length=10, null=True)),
                ('case_pack_column', models.CharField(blank=True, max_length=10, null=True)),
                ('header_row', models.IntegerField(default=1)),
                ('sheet_name', models.CharField(blank=True, help_text='Sheet name for multi-tab Excel files', max_length=100, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('vendor', models.ForeignKey(db_column='vendor_code', on_delete=django.db.models.deletion.CASCADE, related_name='import_mappings', to='dsd.vendor')),
            ],
            options={
                'verbose_name': 'Vendor Import Mapping',
                'verbose_name_plural': 'Vendor Import Mappings',
                'db_table': 'dsd_vendor_import_mapping',
                'unique_together': {('vendor', 'mapping_name')},
            },
        ),
    ]
